;(function($) {
    'use strict';

    // Êèí‰ª∂ÈªòËÆ§ÈÖçÁΩÆ
    const defaults = {
        inputTarget: null,  // ËæìÂÖ•ÁõÆÊ†áÂÖÉÁ¥†
        position: 'bottom',  // ÂºπÂá∫‰ΩçÁΩÆÔºöbottom, top, left, right
        onSelect: null,  // ÈÄâÊã©Ë°®ÊÉÖÂêéÁöÑÂõûË∞ÉÂáΩÊï∞
    };

    class EmojiPicker {
        constructor(element, options) {
            this.element = element;
            this.settings = $.extend({}, defaults, options);
            this.init();
        }

        // Â∏∏ÈáèÊï∞ÊçÆ
        static get CATEGORIES() {
            return {
                'üòä': [
                    'üïê',      // Êó∂ÈíüÂõæÊ†á‰ª£Ë°®"ÊúÄËøë‰ΩøÁî®"
                    'üòä',      // Á¨ëËÑ∏ÂõæÊ†á‰ª£Ë°®"Á¨ëËÑ∏ÂíåÂä®Áâ©"
                    'üë©',      // Â•≥ÊÄßÂõæÊ†á‰ª£Ë°®"‰∫∫"
                    'üéà',      // Ê∞îÁêÉÂõæÊ†á‰ª£Ë°®"Â∫ÜÁ•ùÂíåÁâ©ÂìÅ"
                    'üçï',      // È£üÁâ©ÂõæÊ†á‰ª£Ë°®"È£üÂìÅÂíåÊ§çÁâ©"
                    'üöó',      // Ê±ΩËΩ¶ÂõæÊ†á‰ª£Ë°®"‰∫§ÈÄöÂíåÂú∞ÁÇπ"
                    '‚ô°'       // Á©∫ÂøÉÁà±ÂøÉÂõæÊ†á‰ª£Ë°®"Áà±ÂøÉ"
                ],
                ';-)': ['üïê', ':D', ':)', '(^o^)', ':(', '>:(', ':|', ':O'],
                'Œ©': ['üïê', 'üìè', '‚ë†', '‚ö°', '‚ùó', '‚ûï', '‚¨õ', 'Œ©']
            };
        }

        static get TAB_MAPPING() {
            return {
                'üòä': 'Ë°®ÊÉÖÁ¨¶Âè∑',
                ';-)': 'È¢úÊñáÂ≠ó',
                'Œ©': 'Á¨¶Âè∑'
            };
        }

        static get SECONDARY_TAB_MAPPING() {
            return {
                'üïê': 'ÊúÄËøë‰ΩøÁî®',
                'üòä': 'Á¨ëËÑ∏ÂíåÂä®Áâ©',
                'üë©': '‰∫∫',
                'üéà': 'Â∫ÜÁ•ùÂíåÁâ©ÂìÅ',
                'üçï': 'È£üÂìÅÂíåÊ§çÁâ©',
                'üöó': '‰∫§ÈÄöÂíåÂú∞ÁÇπ',
                '‚ô°': 'Áà±ÂøÉ',
                
                ':D': 'ÂºÄÂøÉ',
                ':)': 'ÈóÆÂÄô',
                '(^o^)': 'ÂçñËêå',
                ':(': 'Âøß‰º§',
                '>:(': 'ÁîüÊ∞î',
                ':|': 'Êó†ËØ≠',
                ':O': 'ÊÉäËÆ∂',
                
                'üìè': 'Âçï‰Ωç',
                '‚ë†': 'Â∫èÂè∑',
                '‚ö°': 'ÁâπÊÆäÁ¨¶Âè∑',
                '‚ùó': 'Ê†áÁÇπÁ¨¶Âè∑',
                '‚ûï': 'Êï∞Â≠¶',
                '‚¨õ': 'Âá†‰Ωï',
                'Œ©': 'Â≠óÊØç'
            };
        }

        static get EMOJI_DATA() {
            return {
                'Á¨ëËÑ∏ÂíåÂä®Áâ©': [
                    // Á¨¨‰∏ÄË°å
                    'üòÄ', 'üòÅ', 'üòÇ', 'ü§£', 'üòÉ', 'üòÑ', 'üòÖ', 'üòÜ',
                    // Á¨¨‰∫åË°å
                    'üòâ', 'üòä', 'üòã', 'üòé', 'üòç', 'üòò', 'üòó', 'üòô',
                    // Á¨¨‰∏âË°å
                    'üòö', 'üôÇ', 'ü§ó', 'ü§©', 'ü§î', 'ü§®', 'üòê', 'üòë',
                    // Á¨¨ÂõõË°å
                    'üò∂', 'üôÑ', 'üòè', 'üò£', 'üò•', 'üòÆ', 'ü§ê', 'üòØ',
                    // Á¨¨‰∫îË°å
                    'üò™', 'üò´', 'üò¥', 'üòå', 'üòõ', 'üòú', 'üòù', 'ü§§',
                    // Á¨¨ÂÖ≠Ë°å
                    'üòí', 'üòì', 'üòî', 'üòï', 'üôÉ', 'ü§ë', 'üò≤', '‚òπÔ∏è',
                    // Á¨¨‰∏ÉË°å
                    'üôÅ', 'üòñ', 'üòû', 'üòü', 'üò§', 'üò¢', 'üò≠', 'üò¶',
                    // Á¨¨ÂÖ´Ë°å
                    'üòß', 'üò®', 'üò©', 'ü§Ø', 'üò¨', 'üò∞', 'üò±', 'ü•µ',
                    // Á¨¨‰πùË°å
                    'ü•∂', 'üò≥', 'ü§™', 'üòµ', 'üò°', 'üò†', 'ü§¨', 'üò∑',
                    // Á¨¨ÂçÅË°å
                    'ü§í', 'ü§ï', 'ü§¢', 'ü§Æ', 'ü§ß', 'üòá', 'ü§†', 'ü§°',
                    // Á¨¨ÂçÅ‰∏ÄË°å
                    'ü•≥', 'ü•¥', 'ü•∫', 'ü§•', 'ü§´', 'ü§≠', 'üßê', 'ü§ì'
                ],
                '‰∫∫': [
                    // Á¨¨‰∏ÄË°å - ÊâãÂäø
                    'üëã', 'ü§ö', '‚úã', 'üñêÔ∏è', 'üëå', 'üëä', 'ü§è', '‚úåÔ∏è',
                    // Á¨¨‰∫åË°å - ÊâãÂäø
                    'ü§û', '‚úåÔ∏è', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ',
                    // Á¨¨‰∏âË°å - ÊâãÂäø
                    'üñï', 'üëá', '‚òùÔ∏è', 'üëç', 'üëé', '‚úä', 'üëä', 'ü§õ',
                    // Á¨¨ÂõõË°å - ÊâãÂäøÂíåË∫´‰ΩìÈÉ®‰Ωç
                    'ü§ú', 'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè', '‚úçÔ∏è',
                    // Á¨¨‰∫îË°å - Ë∫´‰ΩìÈÉ®‰Ωç
                    'üí™', 'ü¶æ', 'ü¶ø', 'ü¶µ', 'ü¶∂', 'üëÇ', 'ü¶ª', 'üëÉ',
                    // Á¨¨ÂÖ≠Ë°å - ‰∫∫Áâ©
                    'üë∂', 'üëß', 'üßí', 'üë¶', 'üë©', 'üßë', 'üë®', 'üë±‚Äç‚ôÄÔ∏è',
                    // Á¨¨‰∏ÉË°å - ‰∫∫Áâ©
                    'üë±', 'üë±‚Äç‚ôÇÔ∏è', 'üë¥', 'üëµ', 'üßì', 'üôç‚Äç‚ôÄÔ∏è', 'üôç', 'üôç‚Äç‚ôÇÔ∏è',
                    // Á¨¨ÂÖ´Ë°å - ‰∫∫Áâ©Âä®‰Ωú
                    'üôé‚Äç‚ôÄÔ∏è', 'üôé', 'üôé‚Äç‚ôÇÔ∏è', 'üôÖ‚Äç‚ôÄÔ∏è', 'üôÖ', 'üôÖ‚Äç‚ôÇÔ∏è', 'üôÜ‚Äç‚ôÄÔ∏è', 'üôÜ',
                    // Á¨¨‰πùË°å - ‰∫∫Áâ©Âä®‰Ωú
                    'üôÜ‚Äç‚ôÇÔ∏è', 'üíÅ‚Äç‚ôÄÔ∏è', 'üíÅ', 'üíÅ‚Äç‚ôÇÔ∏è', 'üôã‚Äç‚ôÄÔ∏è', 'üôã', 'üôã‚Äç‚ôÇÔ∏è', 'üßè‚Äç‚ôÄÔ∏è',
                    // Á¨¨ÂçÅË°å - ‰∫∫Áâ©Âä®‰Ωú
                    'üßè', 'üßè‚Äç‚ôÇÔ∏è', 'üôá‚Äç‚ôÄÔ∏è', 'üôá', 'üôá‚Äç‚ôÇÔ∏è', 'ü§¶‚Äç‚ôÄÔ∏è', 'ü§¶', 'ü§¶‚Äç‚ôÇÔ∏è',
                    // Á¨¨ÂçÅ‰∏ÄË°å - ‰∫∫Áâ©Âä®‰Ωú
                    'ü§∑‚Äç‚ôÄÔ∏è', 'ü§∑', 'ü§∑‚Äç‚ôÇÔ∏è', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üë®‚Äçüéì', 'üë©‚Äçüéì', 'üë®‚Äçüè´',
                    // Á¨¨ÂçÅ‰∫åË°å - ËÅå‰∏ö
                    'üë©‚Äçüè´', 'üë®‚Äç‚öñÔ∏è', 'üë©‚Äç‚öñÔ∏è', 'üë®‚Äçüåæ', 'üë©‚Äçüåæ', 'üë®‚Äçüç≥', 'üë©‚Äçüç≥', 'üë®‚Äçüîß',
                    // Á¨¨ÂçÅ‰∏âË°å - ËÅå‰∏ö
                    'üë©‚Äçüîß', 'üë®‚Äçüè≠', 'üë©‚Äçüè≠', 'üë®‚Äçüíº', 'üë©‚Äçüíº', 'üë®‚Äçüî¨', 'üë©‚Äçüî¨', 'üë®‚Äçüíª',
                    // Á¨¨ÂçÅÂõõË°å - ËÅå‰∏öÂíåÂÖ∂‰ªñ
                    'üë©‚Äçüíª', 'üë®‚Äçüé§', 'üë©‚Äçüé§', 'üë®‚Äçüé®', 'üë©‚Äçüé®', 'üë®‚Äç‚úàÔ∏è', 'üë©‚Äç‚úàÔ∏è', 'üëÆ'
                ],
                'ÂºÄÂøÉ': [
                    '(*^‚ñΩ^*)',     '(‚óï‚Äø‚óï)',       '(ÔΩ°‚ô•‚Äø‚ô•ÔΩ°)',
                    '„ÉΩ(¬¥‚ñΩ`)/',    '(Ôºæ‚ñΩÔºæ)',      '(‚ó†‚Äø‚ó†)',
                    '„ÉΩ(‚ô°‚Äø‚ô°)„Éé',   '(ÔΩÄ„Éªœâ„Éª¬¥)',   '(¬¥ÔΩ°‚Ä¢ ·µï ‚Ä¢ÔΩ°`)',
                    '( ¬¥ ‚ñΩ ` )Ôæâ',  '„ÉΩ(>‚àÄ<‚òÜ)„Éé',  'Ôºº(Ôø£‚ñΩÔø£)Ôºè',
                    '(Ôæâ¬¥„ÉÆ`)Ôæâ*',    '(‚âß‚àÄ‚â¶)',       'o(„ÄÉÔºæ‚ñΩÔºæ„ÄÉ)o',
                    '(ÔΩÄÔΩ•œâÔΩ•¬¥)„Çû',   '(¬¥ÔΩ•·¥óÔΩ•`)',     '(¬¥‚ó°`‚ùÅ)',
                    '(‡πëÀÉ·¥óÀÇ)Ôª≠',     'o((*^‚ñΩ^*))o',  '(‚óç‚Ä¢·¥ó‚Ä¢‚óç)',
                    '(Ôæâ‚óï„ÉÆ‚óï)Ôæâ*',    '„ÉΩ(oÔºæ‚ñΩÔºæo)„Éé', 'Ÿ©(‚óï‚Äø‚óïÔΩ°)€∂',
                    '(„ÄÉÔø£Ô∏∂Ôø£)‰∫∫',   '(Ôæü‚àÄÔæü)',      '(o¬¥‚àÄ`o)',
                    '(‡πë¬Ø‚àÄ¬Ø‡πë)',     '(*¬¥‚àÄ`*)',     '(ÔΩ°¬¥‚àÄÔΩÄ)Ôæâ',
                    '(‚óè¬¥‚àÄ`‚óè)',     '„ÉΩ(ÔΩ•‚àÄÔΩ•)Ôæâ',    'o(^‚ñΩ^)o',
                    '„ÉΩ(ÔΩ°‚óï‚Äø‚óïÔΩ°)Ôæâ',   '(ÔΩÄÔΩ•„â®ÔΩ•¬¥)',    '(‚óè¬¥œâÔΩÄ‚óè)',
                    '(*‚âßœâ‚â¶*)',     '(‚óï‚Äø‚óï‚úø)',      '(¬¥ÔΩ•œâÔΩ•`)',
                    '(‚åí‚Äø‚åí)',       '(*^‚Äø^*)',      '(‚ó†Ôπè‚ó†)',
                    '(‚úø‚ó†‚Äø‚ó†)',      '(‚ó°‚Äø‚ó°‚úø)',      '(‚úø‚ïπ‚ó°‚ïπ)',
                    '(‚óï·¥ó‚óï‚úø)',      '(Ôæâ‚óï„ÉÆ‚óï)Ôæâ*:ÔΩ•Ôæü‚úß', '(‚Äû‚Ä¢ ÷ä ‚Ä¢‚Äû)',
                    '(ÔΩ°‚ô•‚Äø‚ô•ÔΩ°)',     '(‚úø ‚ô•‚Äø‚ô•)',     '(‚óç‚Ä¢·¥ó‚Ä¢‚óç)‚ù§'
                ],
                'ÈóÆÂÄô': [
                    '(ÔΩ°ÔΩ•‚àÄÔΩ•)ÔæâÔæû',      '„Éæ(„Éªœâ„Éª*)',     '(*¬¥‚àÄ`)~‚ô•',
                    '(ÔΩÄÔΩ•œâÔΩ•¬¥)„Çû',     '„Éæ(^‚ñΩ^*)))',    '(„ÄÇ„Éªœâ„Éª)„Éé',
                    '(‚âß‚àÄ‚â¶)„Çû',       '(‚óè¬¥‚àÄÔΩÄ‚óè)Ôæâ',     '„Éæ(‚óè„Çú‚ñΩ„Çú‚óè)',
                    '(*¬¥„ÉªÔΩñ„Éª)',     '(ÔΩÄ„Éªœâ„Éª¬¥)',    '„Éæ(^‚ñΩ^„Éæ)',
                    '(„ÄÉÔΩ•œâÔΩ•)Ôæâ~‚òÜ',    '„ÉΩ(*„Éªœâ„Éª)Ôæâ',    '(oÔΩ•œâÔΩ•o)Ôæâ',
                    '„Éæ(ÔΩ•œâÔΩ•`ÔΩ°)',     '(ÔΩÄÔΩ•‚àÄÔΩ•¬¥)„Çû',     '„Éæ(ÔΩ•‚àÄÔΩ•`)Ôæâ',
                    '(¬¥ÔΩ•omegaÔΩ•ÔΩÄ)',   '„ÉΩ(ÔΩ•‚àÄÔΩ•)Ôæâ',      '„Éæ(ÔΩ•œâÔΩ•`‚óè)Ôæâ'
                ],
                'ÂçñËêå': [
                    '(ÔΩ°‚óï‚Äø‚óïÔΩ°)',      '(‚óïœâ‚óï)',        '(‚óè„Çùœâ„Éª)',
                    '(‚åí)‚ô°',      '(ÔΩ°‚ô•‚Äø‚ô•ÔΩ°)',      '(‚óï‚Äø‚óï‚úø)',
                    '(‚ó†‚Äø‚ó†)',       '(‚ó°‚Äø‚ó°‚úø)',      '(‚úø‚ó†‚Äø‚ó†)',
                    '(‚óï·¥ó‚óï‚úø)',      '(‚óï‚Äø‚óï)',        '(ÔΩ°‚óï‚Äø‚óïÔΩ°)',
                    '(‚óè¬¥œâÔΩÄ‚óè)',     '(‚óï‚Äø‚óï‚úø)',       '(‚ó†œâ‚ó†‚úø)',
                    '(‚óï‚ñ≥‚óï‚úø)',      '(ÔΩ°‚óï‚Äø‚óïÔΩ°)',      '(‚óè¬¥‚àÄÔΩÄ‚óè)',
                    '(‚úø¬¥‚Äø`)',      '(‚ó†‚Äø‚ó†‚úø)',      '(‚óï‚Äø‚óï‚úø)'
                ],
                'Âøß‰º§': [
                    '(¬¥;œâ;ÔΩÄ)',      '(Ôπè‚ï•)',        '(;¬¥–¥ÔΩÄ)',
                    '(¬¥ÔºõœâÔºõÔΩÄ)',     '(ÔΩ°‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄÔΩ°)',     '(ÔΩ°≈èÔπè≈è)',
                    '(„Å£ÀòÃ©‚ï≠‚ïÆÀòÃ©)„Å£',   '(ÔΩ°≈èÔπè≈è)',       '(¬¥;Ô∏µ;`)',
                    '(ÔΩ°‚ïØÔ∏µ‚ï∞ÔΩ°)',      '(‚ï•_‚ï•)',         '(„Å£- ‚Ä∏ ‚Äì œÇ)',
                    '(¬¥;œâ;ÔΩÄ)',      '(ÔΩ°·µïÔ∏µ·µïÔΩ°)',      '(ÔΩ°‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄÔΩ°)',
                    '(‡πë‚óïÔ∏µ‚óï‡πë)',      '(¬¥;–¥;`)',       '(„Å§Ôπè<„ÄÇ)',
                    '(ÔΩ°≈è_≈è)',       '(ÔΩ°‚Ä¢ÃÅÔ∏ø‚Ä¢ÃÄÔΩ°)',     '(‚ãüÔπè‚ãû)'
                ],
                'ÁîüÊ∞î': [
                    '(ÔΩÄÁöø¬¥ÔºÉ)',      '(‚ï¨Ôæü–¥Ôæü)',       '(‚ï¨`Áõä¬¥)',
                    '(‚Ä°‚ñºÁõä‚ñº)',      '(‚ï¨ √íÔπè√ì)',      '(ÔºÉ`–î¬¥)',
                    '(‚óèÔΩÄŒµ¬¥‚óè)',      '(‚óû‚Ä∏‚óüÔºõ)',      '„ÉΩ(ÔΩÄ‚åí¬¥„É°)„Éé',
                    '(ÔΩÄ–î¬¥*)',       '(ÔºÉÔΩÄ–¥¬¥)Ôæâ',     '(ÔΩ•ÔΩÄ¬¥ÔΩ•)',
                    '(ÔΩÄŒµ¬¥)',        '(ÔΩÄ–î¬¥)',        'œà(ÔΩÄ‚àá¬¥)œà',
                    '(„ÉéÔΩÄ–î¬¥)„Éé',     '(‚ï¨ÔΩÄÁõä¬¥)',      '(ÔΩÄœâ¬¥)',
                    '(ÔΩÄ‚óá¬¥)',        '(ÔΩÄ„Éº¬¥)',       '(ÔæíÔΩÄÔæõ¬¥)/'
                ],
                'Êó†ËØ≠': [
                    '(Ôø£‚ñΩÔø£*)„Çû',    '(-_-;)„Éª„Éª„Éª',    '(Ôø£ÔΩûÔø£;)',
                    '(Ôºõ‰∏Ä_‰∏Ä)',      '(¬¨_¬¨)',         '(‚Üê_‚Üê)',
                    '(Ôºõ¬¨_¬¨)',       '(Ôø£ÔΩûÔø£)',       '(-_-„É°)',
                    '(-_-;)„Çû',      '(Ôºõ-_-)',       '(ÔΩÄ_¬¥)„Çû',
                    '(Ôø£œâÔø£;)',      '(Ôø£‚ñ°Ôø£„Äç)',     '(ÔºÉÔø£œâÔø£)',
                    '(Ôø£‚ÄêÔø£)',       '(ÔºÉÔø£ÔΩûÔø£ÔºÉ)',   '(ÔºõÔø£–îÔø£)',
                    '(Ôø£ÔΩûÔø£)',      '(„ÉºÔø£)',       '(„Éº_„Éº)!!'
                ],
                'ÊÉäËÆ∂': [
                    '(‚äô_‚äô)',        '(‚äôo‚äô)',        'w(Ôæü–îÔæü)w',
                    '(¬¥‚äôœâ‚äô`)',      '(ÔΩÄ„Éªœâ„Éª¬¥)',     '(¬∞„Éº¬∞„ÄÉ)',
                    'Œ£(„Çú„É≠„Çú;)',    '(‚äô_‚äô;)',       '(;¬∞–î¬∞)',
                    '(„ÄÇ‚ñ°„ÄÇ)',       '(Ôæü–¥ÔæüÔºõ)',      '(„Çú-„Çú)',
                    '(‚óé_‚óé;)',       '(‚óè__‚óè)',       '(Ôæü‚ñ°Ôæü*)',
                    '(Ôæü„ÄáÔæü)',       '(ÔæüËâ∏Ôæü;)',      '(;Ôæü–¥Ôæü)',
                    '(;„Çú‚óã„Çú)',      '(Ôºõ„Çú‚óã„Çú)',     '(;Ôø¢_Ôø¢)'
                ],
                'Âçï‰Ωç': [
                    '¬∞', '‚ÑÉ', '‚Ñâ', '„éé', '„éè', '„éú', '„éù', '„éû',
                    '„é°', '„é•', '„é¶', '„éõ', '„éü', '„é†', '„é§', '„é™',
                    '„é´', '„é≠', '„éÆ', '„éØ', '„é∞', '„é±', '„é≤', '„é≥',
                    '„é¥', '„éµ', '„é∂', '„é∑', '„é∏', '„éπ', '„é∫', '„èÑ',
                    '„èé', '„èë', '„èí', '„èï', '‚Ä∞', 'ÔºÖ', '‚Ä±', '‚ÑÆ'
                ],
                'Â∫èÂè∑': [
                    '‚ë†', '‚ë°', '‚ë¢', '‚ë£', '‚ë§', '‚ë•', '‚ë¶', '‚ëß',
                    '‚ë®', '‚ë©', '‚ë™', '‚ë´', '‚ë¨', '‚ë≠', '‚ëÆ', '‚ëØ',
                    '‚Ö†', '‚Ö°', '‚Ö¢', '‚Ö£', '‚Ö§', '‚Ö•', '‚Ö¶', '‚Öß',
                    '‚Ö®', '‚Ö©', '‚Ö™', '‚Ö´', '‚íà', '‚íâ', '‚íä', '‚íã',
                    '‚íå', '‚íç', '‚íé', '‚íè', '‚íê', '‚íë', '‚íí', '‚íì'
                ],
                'ÁâπÊÆäÁ¨¶Âè∑': [
                    '¬©', '¬Æ', '‚Ñ¢', '‚Ñ†', '¬ß', '¬∂', '‚Ä†', '‚Ä°',
                    '‚Äª', '‚ÅÇ', '‚òÆ', '‚òØ', '‚ò™', '‚ò≠', '‚ô®', '‚ò¢',
                    '‚ò£', '‚ò§', '‚öï', '‚öú', '‚ö†', '‚òî', '‚ôø', '‚ö°',
                    '‚òé', '‚åõ', '‚ò∫', '‚òπ', '‚ô†', '‚ô•', '‚ô£', '‚ô¶',
                    '‚úì', '‚úî', '‚úó', '‚úò', '‚ô™', '‚ô´', '‚ôØ', '‚ô≠'
                ],
                'Ê†áÁÇπÁ¨¶Âè∑': [
                    '¬∑', '‚Ä•', '‚Ä¶', '‚Äß', 'Ôπí', 'Ôºé', '„Äå', '„Äç',
                    '„Äé', '„Äè', '„Äî', '„Äï', '„Äê', '„Äë', '„Ää', '„Äã',
                    '„Äà', '„Äâ', 'Ôπô', 'Ôπö', 'Ôπõ', 'Ôπú', 'Ôπù', 'Ôπû',
                    '„Äù', '„Äû', '‚Äµ', '‚Ä≤', '„ÄÉ', 'ÔΩû', '‚à•', 'Ôπâ',
                    'Ôπä', 'Ôπã', 'Ôπå', 'Ôπç', 'Ôπé', 'Ôπè', 'Ôπê', 'Ôπë'
                ],
                'Êï∞Â≠¶': [
                    'Ôºã', 'Ôºç', '√ó', '√∑', 'Ôºù', '‚â†', '‚âí', '‚àû',
                    '¬±', '‚àö', '‚àµ', '‚à¥', '‚à∑', '‚â§', '‚â•', '‚à†',
                    '‚ä•', '‚à™', '‚à©', '‚àà', '‚àë', '‚àè', '‚àÖ', 'œÄ',
                    'Œî', 'Œ¶', 'Œ®', 'Œ©', '‚à´', '‚àÆ', '‚àù', '‚àü',
                    '‚àá', '‚àÜ', '‚àÉ', '‚àÄ', '‚àÇ', '‚àá', '‚â°', '‚âå'
                ],
                'Âá†‰Ωï': [
                    '‚ñ≥', '‚ñ≤', '‚ñΩ', '‚ñº', '‚óá', '‚óÜ', '‚óã', '‚óè',
                    '‚ñ°', '‚ñ†', '‚ñ¢', '‚ñ£', '‚ñ§', '‚ñ•', '‚ñ¶', '‚ñß',
                    '‚ñ®', '‚ñ©', '‚ñ™', '‚ñ´', '‚ñ¨', '‚ñ≠', '‚ñÆ', '‚ñØ',
                    '‚ñ∞', '‚ñ±', '‚ñ≤', '‚ñ∂', '‚ñº', '‚óÄ', '‚ó¢', '‚ó£',
                    '‚ó§', '‚ó•', '‚óê', '‚óë', '‚óí', '‚óì', '‚óî', '‚óï'
                ],
                'Â≠óÊØç': [
                    'Œ±', 'Œ≤', 'Œ≥', 'Œ¥', 'Œµ', 'Œ∂', 'Œ∑', 'Œ∏',
                    'Œπ', 'Œ∫', 'Œª', 'Œº', 'ŒΩ', 'Œæ', 'Œø', 'œÄ',
                    'œÅ', 'œÉ', 'œÑ', 'œÖ', 'œÜ', 'œá', 'œà', 'œâ',
                    'Œë', 'Œí', 'Œì', 'Œî', 'Œï', 'Œñ', 'Œó', 'Œò',
                    'Œô', 'Œö', 'Œõ', 'Œú', 'Œù', 'Œû', 'Œü', 'Œ†'
                ],
                'Â∫ÜÁ•ùÂíåÁâ©ÂìÅ': [
                    // Â∫ÜÁ•ùÁõ∏ÂÖ≥
                    'üéà', 'üéÜ', '', '‚ú®', 'üéâ', 'üéä', 'üéã', 'üéç',
                    'üéé', 'üéè', 'üéê', 'üéë', 'üéÄ', 'üéÅ', 'üéó', 'üéü',
                    // Ê¥ªÂä®ÂíåÂ®±‰πê
                    'üé´', 'üéñ', 'üèÜ', 'üèÖ', 'ü•á', 'ü•à', 'ü•â', '‚öΩ',
                    '‚öæ', 'üèÄ', 'üèê', 'üèà', 'üèâ', 'üéæ', 'üé±', 'üé≥',
                    // Áâ©ÂìÅÂíåÂ∑•ÂÖ∑
                    'üì±', 'üì≤', 'üíª', '‚å®', 'üñ•', 'üñ®', 'üñ±', 'üñ≤',
                    'üíΩ', 'üíæ', 'üíø', 'üìÄ', 'üé•', 'üéû', 'üìΩ', 'üé¨',
                    // ÂÖ∂‰ªñÁâ©ÂìÅ
                    'üì∫', 'üì∑', 'üì∏', 'üìπ', 'üìº', 'üîç', 'üîé', 'üî¨',
                    'üî≠', 'üì°', '', 'üí°', 'üî¶', 'üèÆ', 'üìî', 'üìï'
                ],
                'È£üÂìÅÂíåÊ§çÁâ©': [
                    // Ê∞¥Êûú
                    'üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì',
                    'üçà', 'üçí', 'üçë', 'üçç', 'ü•ù', 'üçÖ', 'ü••', 'ü•ë',
                    // Ëî¨Ëèú
                    'ü•¶', 'ü•í', 'ü•¨', 'ü•ï', 'üåΩ', 'ü•ó', 'ü•î', 'üç†',
                    'ü•ú', 'üå∞', 'üçØ', 'ü•ê', 'ü•ñ', 'ü•®', 'ü•Ø', 'ü•û',
                    // ‰∏ªÈ£üÂíåËÇâÁ±ª
                    'üçû', 'üßÄ', 'üçñ', 'üçó', 'ü•©', 'ü•ì', 'üçî', 'üçü',
                    'üå≠', '', 'ü•™', 'üåÆ', 'üåØ', 'ü•ô', 'ü•ö', 'üç≥',
                    // ÁîúÁÇπÂíåÈ•ÆÂìÅ
                    'ü•ò', 'üç≤', 'ü•£', 'ü•ó', 'üçø', 'üßÇ', 'ü•´', 'üç±',
                    'üçò', 'üçô', 'üçö', 'üçõ', 'üçú', 'üçù', 'üç†', 'üç¢',
                    // Ê§çÁâ©
                    'üå±', 'üå≤', 'üå≥', 'üå¥', 'üåµ', 'üåæ', 'üåø', '‚òò',
                    'üçÄ', 'üéç', 'üéã', 'üçÉ', 'üçÇ', 'üçÅ', 'üçÑ', 'üå∏'
                ],
                '‰∫§ÈÄöÂíåÂú∞ÁÇπ': [
                    // ÈôÜÂú∞‰∫§ÈÄö
                    'üöó', 'üöï', 'üöô', 'üöå', 'üöé', 'üèé', 'üöì', 'üöë',
                    'üöí', 'üöê', 'üöö', 'üöõ', 'üöú', 'üö≤', 'üõ¥', 'üõµ',
                    // ÈìÅË∑Ø‰∫§ÈÄö
                    'üöÇ', 'üöÉ', 'üöÑ', 'üöÖ', 'üöÜ', 'üöá', 'üöà', 'üöâ',
                    'üöä', 'üöù', 'üöû', 'üöã', 'üöå', 'üöç', 'üöé', 'üöê',
                    // Á©∫‰∏≠‰∫§ÈÄö
                    '‚úà', 'üõ©', 'üõ´', 'üõ¨', 'üöÅ', 'üöü', 'üö†', 'üö°',
                    'üõ∞', 'üöÄ', 'üõ∏', 'üí∫', 'üõ∂', '‚õµ', 'üõ•', 'üö§',
                    // Âú∞ÁÇπÂíåÂª∫Á≠ë
                    'üè†', 'üè°', 'üè¢', 'üè£', 'üè§', 'üè•', 'üè¶', 'üè®',
                    'üè©', 'üè™', 'üè´', 'üè¨', 'üè≠', 'üèØ', 'üè∞', 'üíí'
                ],
                'Áà±ÂøÉ': [
                    // Á¨¨‰∏ÄË°å - ÂΩ©Ëâ≤ÂøÉÂΩ¢
                    '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'ü§é', 'üñ§',
                    // Á¨¨‰∫åË°å - ÁôΩËâ≤ÂíåÁâπÊÆäÂøÉÂΩ¢
                    'ü§ç', '‚ù§Ô∏è‚Äçüî•', '‚ù§Ô∏è‚Äçü©π', 'üíù', 'üíñ', 'üíó', 'üíì', 'üíû',
                    // Á¨¨‰∏âË°å - Ë£ÖÈ•∞ÂøÉÂΩ¢
                    'üíï', 'üíü', '‚ù£Ô∏è', 'üíî', '‚ô•Ô∏è', '‚ô°', '‚ù•', '‚û≥‚ù§Ô∏è',
                    // Á¨¨ÂõõË°å - ËÆæÊñΩÂõæÊ†á
                    'üöæ', 'üÖøÔ∏è', 'üö∞', 'üöπ', 'üö∫', 'üöª', 'üöÆ', 'üìä',
                    // Á¨¨‰∫îË°å - ÊñáÂ≠óÂõæÊ†á
                    'üàÅ', 'üà≤', 'üÜó', 'üÜô', 'üÜí', 'üÜï', 'üÜì', '#Ô∏è‚É£',
                    // Á¨¨ÂÖ≠Ë°å - Êï∞Â≠ó 0-6
                    '*Ô∏è‚É£', '0Ô∏è‚É£', '1Ô∏è‚É£', '2Ô∏è‚É£', '3Ô∏è‚É£', '4Ô∏è‚É£', '5Ô∏è‚É£', '6Ô∏è‚É£',
                    // Á¨¨‰∏ÉË°å - Êï∞Â≠ó 7-9 ÂíåÊéßÂà∂
                    '7Ô∏è‚É£', '8Ô∏è‚É£', '9Ô∏è‚É£', 'üîü', 'üî¢', '‚ñ∂Ô∏è', '‚è∏Ô∏è', '‚è≠Ô∏è',
                    // Á¨¨ÂÖ´Ë°å - Êí≠ÊîæÊéßÂà∂
                    '‚èπ', '‚è∫', '‚è©', '‚è™', '‚è´', '‚è¨', 'üîÄ', 'üîÅ',
                    // Á¨¨‰πùË°å - ÊéßÂà∂ÂíåÁ¨¶Âè∑
                    '‚úì', '‚Üê', '‚Üê', '„Äú', 'üëÅ', '‚úì', '$', '‚Üª',
                    // Á¨¨ÂçÅË°å - Êï∞Â≠¶Á¨¶Âè∑
                    '+', '-', '√ó', '√∑', '¬©', '¬Æ', '‚Ñ¢', '‚óØ',
                    // Á¨¨ÂçÅ‰∏ÄË°å - ÂΩ©Ëâ≤ÂúÜÂΩ¢
                    'üî¥', 'üü†', 'üü°', 'üü¢', 'üîµ', 'üü£', 'üü§', '‚ö´',
                    // Á¨¨ÂçÅ‰∫åË°å - ÂΩ©Ëâ≤ÊñπÂΩ¢
                    '‚¨ú', 'üü•', 'üüß', 'üü®', 'üü©', 'üü¶', 'üü™', 'üü´',
                    // Á¨¨ÂçÅ‰∏âË°å - ÈªëËâ≤ÊñπÂΩ¢(Áî±Â§ßÂà∞Â∞è)
                    '‚¨õ', '‚¨ú', '‚óæ', '‚óΩ', '‚ñ™Ô∏è', '‚ñ´Ô∏è', '‚ñ™Ô∏è', '‚ñ´Ô∏è',
                    // Á¨¨ÂçÅÂõõË°å - ÂÆóÊïôÂíåÂíåÂπ≥Á¨¶Âè∑
                    '‚òÆ', '‚úù', '‚ò™', 'üïâ', '‚ò∏', '‚ú°', '‚òØ', '‚ú¥',
                    // Á¨¨ÂçÅ‰∫îË°å - ÊåáÁ§∫Á¨¶Âè∑
                    'üí†', 'üî∑', '‚ú≥', '‚ú¥', '‚ùå', '‚úÖ', 'üí´', 'üåê',
                    // Á¨¨ÂçÅÂÖ≠Ë°å - Ê±âÂ≠óÁ¨¶Âè∑
                    'Ââ≤', 'Êúâ', 'ÁÑ°', 'Áî≥', 'Âñ∂', 'Êúà', '‚ú¥', 'VS',
                    // Êñ∞Â¢ûÊó∂ÈíüÁ≥ªÂàó - Á¨¨‰∏ÄË°å
                    'üïê', 'üïë', 'üïí', 'üïì', 'üïî', 'üïï', 'üïñ', 'üïó',
                    // Êó∂ÈíüÁ≥ªÂàó - Á¨¨‰∫åË°å
                    'üïò', 'üïô', 'üïö', 'üïõ', 'üïú', 'üïù', 'üïû', 'üïü',
                    // Êó∂ÈíüÁ≥ªÂàó - Á¨¨‰∏âË°å
                    'üï†', 'üï°', 'üï¢', 'üï£', 'üï§', 'üï•', 'üï¶', 'üïß',
                    // ÂØπËØùÊ°ÜÁ≥ªÂàó
                    'üí≠', 'üó®Ô∏è', 'üí¨', 'üóØÔ∏è', 'üëÅÔ∏è', '‚è∞', '‚åö', '‚è±Ô∏è'
                ]
            };
        }

        init() {
            this.currentPrimaryTab = 'üòä';
            this.currentSecondaryTab = EmojiPicker.CATEGORIES['üòä'][1];
            this.recentEmojis = new Set();
            
            this.createPickerElement();
            this.bindEvents();
        }

        createPickerElement() {
            // ÂàõÂª∫ÈÄâÊã©Âô®HTMLÁªìÊûÑ
            const pickerHtml = `
                <div class="emoji-picker">
                    <div class="picker-header">
                        <span class="picker-title">Ë°®ÊÉÖÁ¨¶Âè∑</span>
                        <button class="close-btn">‚úï</button>
                    </div>
                    <div class="primary-tabs">
                        <button class="primary-tab active">üòä</button>
                        <button class="primary-tab">;-)</button>
                        <button class="primary-tab">Œ©</button>
                    </div>
                    <div class="emoji-content"></div>
                    <div class="secondary-tabs"></div>
                </div>
            `;

            this.$picker = $(pickerHtml);
            $('body').append(this.$picker);
            this.initializePicker();
        }

        bindEvents() {
            // ÁªëÂÆöÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            $(this.element).on('click', (e) => {
                e.stopPropagation();
                this.toggle();
            });

            // ÁªëÂÆöÂÖ≥Èó≠ÊåâÈíÆ‰∫ã‰ª∂
            this.$picker.find('.close-btn').on('click', () => this.hide());

            // ÁªëÂÆö‰∏ÄÁ∫ßÂàÜÁ±ªÁÇπÂáª‰∫ã‰ª∂
            this.$picker.find('.primary-tab').on('click', (e) => this.onPrimaryTabClick(e));

            // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠
            $(document).on('click', (e) => {
                if (!$(e.target).closest('.emoji-picker').length) {
                    this.hide();
                }
            });
        }

        // ÂÖ∂‰ªñÊñπÊ≥ï...
        initializePicker() {
            this.$picker.find('.picker-title').text(EmojiPicker.TAB_MAPPING[this.currentPrimaryTab]);
            this.updateSecondaryTabs();
            this.updateEmojiContent();
        }

        toggle() {
            if (!this.$picker.is(':visible')) {
                this.show();
            } else {
                this.hide();
            }
        }

        show() {
            this.currentPrimaryTab = 'üòä';
            this.currentSecondaryTab = EmojiPicker.CATEGORIES['üòä'][1];
            
            this.$picker.find('.primary-tab').removeClass('active')
                       .first().addClass('active');
            
            this.initializePicker();
            this.updatePosition();
            this.$picker.show();
        }

        hide() {
            this.$picker.hide();
        }

        updatePosition() {
            const buttonPos = $(this.element).offset();
            const buttonHeight = $(this.element).outerHeight();
            
            this.$picker.css({
                top: buttonPos.top + buttonHeight + 5,
                left: buttonPos.left
            });
        }

        // Ê∑ªÂä†Áº∫Â§±ÁöÑÊñπÊ≥ï
        onPrimaryTabClick(e) {
            const $tab = $(e.currentTarget);
            this.currentPrimaryTab = $tab.text();
            
            this.$picker.find('.primary-tab').removeClass('active');
            $tab.addClass('active');
            
            this.$picker.find('.picker-title').text(EmojiPicker.TAB_MAPPING[this.currentPrimaryTab]);
            this.currentSecondaryTab = EmojiPicker.CATEGORIES[this.currentPrimaryTab][1];
            
            this.updateSecondaryTabs();
            this.updateEmojiContent();
        }

        updateSecondaryTabs() {
            const secondaryTabs = EmojiPicker.CATEGORIES[this.currentPrimaryTab];
            const $secondaryTabs = this.$picker.find('.secondary-tabs');
            $secondaryTabs.empty();
            
            secondaryTabs.forEach(tab => {
                const isActive = tab === this.currentSecondaryTab ? 'active' : '';
                $secondaryTabs.append(
                    `<button class="secondary-tab ${isActive}" title="${EmojiPicker.SECONDARY_TAB_MAPPING[tab]}">${tab}</button>`
                );
            });

            // ‰∫åÁ∫ßÂàÜÁ±ªÊ†áÁ≠æÁÇπÂáª‰∫ã‰ª∂
            this.$picker.find('.secondary-tab').on('click', (e) => {
                const $tab = $(e.currentTarget);
                this.$picker.find('.secondary-tab').removeClass('active');
                $tab.addClass('active');
                this.currentSecondaryTab = $tab.text();
                this.updateEmojiContent();
            });
        }

        updateEmojiContent() {
            const $content = this.$picker.find('.emoji-content');
            $content.empty();
            
            // ÁßªÈô§‰πãÂâçÁöÑÈ¢ùÂ§ñÁ±ªÂêç
            $content.removeClass('kaomoji-content symbol-content');

            const categoryName = EmojiPicker.SECONDARY_TAB_MAPPING[this.currentSecondaryTab];
            
            if (categoryName === 'ÊúÄËøë‰ΩøÁî®') {
                Array.from(this.recentEmojis).forEach(emoji => {
                    $content.append(this.createEmojiElement(emoji));
                });
                return;
            }

            const emojis = EmojiPicker.EMOJI_DATA[categoryName] || [];
            
            // Âà§Êñ≠ÂΩìÂâçÂàÜÁ±ªÁ±ªÂûã
            const isKaomoji = this.currentPrimaryTab === ';-)';
            const isSymbol = this.currentPrimaryTab === 'Œ©';
            
            if (isKaomoji) {
                $content.addClass('kaomoji-content');
            } else if (isSymbol) {
                $content.addClass('symbol-content');
            }
            
            emojis.forEach(emoji => {
                let className = 'emoji-item';
                if (isKaomoji) {
                    className = 'kaomoji-item';
                } else if (isSymbol) {
                    className = 'symbol-item';
                }
                
                const $element = this.createEmojiElement(emoji, className);
                $content.append($element);
            });
        }

        createEmojiElement(emoji, className = 'emoji-item') {
            const $emoji = $(`<span class="${className}" title="ÁÇπÂáªÊèíÂÖ•Ë°®ÊÉÖ">${emoji}</span>`);
            
            $emoji.on('click', () => {
                this.insertEmoji(emoji);
            });
            
            return $emoji;
        }

        insertEmoji(emoji) {
            if (this.settings.inputTarget) {
                const $input = $(this.settings.inputTarget);
                const pos = $input[0].selectionStart;
                const text = $input.val();
                
                $input.val(text.slice(0, pos) + emoji + text.slice(pos));
                $input[0].setSelectionRange(pos + emoji.length, pos + emoji.length);
                $input.focus();
            }

            // Ê∑ªÂä†Âà∞ÊúÄËøë‰ΩøÁî®
            this.recentEmojis.add(emoji);
            if (this.recentEmojis.size > 30) {
                this.recentEmojis.delete(Array.from(this.recentEmojis)[0]);
            }

            // Ëß¶ÂèëÈÄâÊã©ÂõûË∞É
            if (typeof this.settings.onSelect === 'function') {
                this.settings.onSelect(emoji);
            }
        }
    }

    // Ê≥®ÂÜå‰∏∫jQueryÊèí‰ª∂
    $.fn.emojiPicker = function(options) {
        return this.each(function() {
            if (!$.data(this, 'emojiPicker')) {
                $.data(this, 'emojiPicker', new EmojiPicker(this, options));
            }
        });
    };

})(jQuery); 